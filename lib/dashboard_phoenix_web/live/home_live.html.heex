<div class="min-h-screen flex flex-col" id="panel-state-container" phx-hook="PanelState">
  <!-- Header Component -->
  <div>
    <.live_component
      module={HeaderComponent}
      id="header"
      agent_sessions_count={@agent_sessions_count}
      agent_progress_count={@agent_progress_count}
      coding_agent_pref={@coding_agent_pref}
      opencode_server_status={@opencode_server_status}
      health_status={@health_status}
      health_last_check={@health_last_check}
    />
  </div>

  <!-- Activity Panel - Recent high-priority events -->
  <.live_component
    module={ActivityPanelComponent}
    id="activity-panel"
    events={@activity_events}
    collapsed={@activity_collapsed}
  />

  <!-- Work Panel - Unified view of all coding agents -->
  <.live_component
    module={WorkPanelComponent}
    id="work-panel"
    agent_sessions={@agent_sessions}
    opencode_sessions={@opencode_sessions}
    gemini_server_status={@gemini_server_status}
    gemini_output={@gemini_output}
    work_panel_collapsed={@work_panel_collapsed}
  />

  <!-- Main Dashboard Layout -->
  <div class="flex-1 flex flex-col gap-6 overflow-y-auto">
    
    <!-- ═══════════════════════════════════════════════════════════════════════════ -->
    <!-- CORE WORK - Linear / Chainlink / PRs / Branches                             -->
    <!-- ═══════════════════════════════════════════════════════════════════════════ -->
    <section class="glass-morphism p-5 section-core-work" style="border-radius: 16px; background: linear-gradient(135deg, rgba(34, 197, 94, 0.08) 0%, rgba(255, 255, 255, 0.05) 100%), rgba(255, 255, 255, 0.05); border-left: 3px solid rgba(34, 197, 94, 0.5);">
      <div class="flex items-center gap-3 mb-4">
        <div class="status-beacon text-green-400"></div>
        <h2 class="text-section-header text-base-content font-semibold tracking-wide">
          <span class="terminal-cursor">Core Work</span>
        </h2>
        <span class="text-xs text-slate-500 dark:text-slate-400 ml-2">Tickets • PRs • Branches</span>
      </div>
      <div class="space-y-3">
        <!-- Linear Tickets Panel (LiveComponent) - High Priority -->
        <div class={[
          "panel-priority-high panel-accent-critical relative",
          DashboardPhoenix.PanelStatus.status_classes(:linear, %{
            error: @linear_error, 
            loading: @linear_loading, 
            tickets: @linear_tickets
          })
        ]}>
          <.live_component
            module={LinearComponent}
            id="linear-tickets"
            linear_tickets={@linear_tickets}
            linear_counts={@linear_counts}
            linear_loading={@linear_loading}
            linear_error={@linear_error}
            linear_collapsed={@linear_collapsed}
            linear_status_filter={@linear_status_filter}
            tickets_in_progress={@tickets_in_progress}
          />
        </div>

        <!-- Chainlink Issues Panel (LiveComponent) - High Priority -->
        <div class={[
          "panel-priority-high panel-accent-critical relative",
          DashboardPhoenix.PanelStatus.status_classes(:chainlink, %{
            error: @chainlink_error,
            loading: @chainlink_loading,
            issues: @chainlink_issues,
            work_in_progress: @chainlink_work_in_progress
          })
        ]}>
          <.live_component
            module={ChainlinkComponent}
            id="chainlink-issues"
            chainlink_issues={@chainlink_issues}
            chainlink_loading={@chainlink_loading}
            chainlink_error={@chainlink_error}
            chainlink_collapsed={@chainlink_collapsed}
            chainlink_work_in_progress={@chainlink_work_in_progress}
          />
        </div>

        <!-- GitHub Pull Requests Panel - High Priority -->
        <div class={[
          "panel-priority-high panel-accent-critical relative",
          DashboardPhoenix.PanelStatus.status_classes(:github_prs, %{
            error: @github_prs_error,
            loading: @github_prs_loading,
            prs: @github_prs,
            verifications: @pr_verifications
          })
        ]}>
          <.live_component
            module={PRsComponent}
            id="prs-panel"
            github_prs={@github_prs}
            github_prs_loading={@github_prs_loading}
            github_prs_error={@github_prs_error}
            github_prs_last_updated={@github_prs_last_updated}
            prs_collapsed={@prs_collapsed}
            prs_in_progress={@prs_in_progress}
            pr_verifications={@pr_verifications}
            pr_fix_pending={@pr_fix_pending}
          />
        </div>

        <!-- Unmerged Branches Panel - Medium Priority -->
        <div class={[
          "panel-priority-medium panel-accent-active relative",
          DashboardPhoenix.PanelStatus.status_classes(:branches, %{
            error: @branches_error,
            loading: @branches_loading,
            branches: @unmerged_branches
          })
        ]}>
          <.live_component
            module={BranchesComponent}
            id="branches-panel"
            unmerged_branches={@unmerged_branches}
            branches_loading={@branches_loading}
            branches_error={@branches_error}
            branches_last_updated={@branches_last_updated}
            branches_collapsed={@branches_collapsed}
            branch_merge_pending={@branch_merge_pending}
            branch_delete_pending={@branch_delete_pending}
          />
        </div>
      </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════════ -->
    <!-- AGENT STATUS - OpenCode / Gemini / Dave / Subagents / Progress              -->
    <!-- ═══════════════════════════════════════════════════════════════════════════ -->
    <section class="glass-morphism p-5 section-agent-status" style="border-radius: 16px; background: linear-gradient(135deg, rgba(168, 85, 247, 0.12) 0%, rgba(255, 255, 255, 0.05) 100%), rgba(255, 255, 255, 0.05); border-left: 3px solid rgba(168, 85, 247, 0.5);">
      <div class="flex items-center gap-3 mb-4">
        <div class="status-beacon text-purple-400"></div>
        <h2 class="text-section-header text-base-content font-semibold tracking-wide">
          <span class="terminal-cursor">Agent Status</span>
        </h2>
        <span class="text-xs text-slate-500 dark:text-slate-400 ml-2">OpenCode • Gemini • Dave • Subagents</span>
      </div>
      <div class="space-y-3">
        <!-- Dave Panel (Main Agent) - First/Top Priority -->
        <div class="panel-priority-high panel-accent-active">
          <.live_component
            module={DaveComponent}
            id="dave-panel"
            agent_sessions={@agent_sessions}
            dave_collapsed={@dave_collapsed}
          />
        </div>

        <!-- Live Progress Panel (LiveComponent) - Medium Priority -->
        <div class="panel-priority-medium panel-accent-active">
          <.live_component
            module={LiveProgressComponent}
            id="live-progress-panel"
            live_progress_collapsed={@live_progress_collapsed}
            agent_progress_count={@agent_progress_count}
            progress_events={@streams.progress_events}
          />
        </div>

        <!-- Sub-Agents Panel - Medium Priority -->
        <div class={[
          "panel-priority-medium relative",
          DashboardPhoenix.PanelStatus.status_classes(:subagents, %{
            sessions: @agent_sessions
          })
        ]}>
          <.live_component
            module={SubagentsComponent}
            id="subagents-panel"
            agent_sessions={@agent_sessions}
            subagents_collapsed={@subagents_collapsed}
            dismissed_sessions={@dismissed_sessions}
            show_completed={@show_completed}
          />
        </div>

        <!-- OpenCode Sessions Panel (LiveComponent) - Quick Reference -->
        <div class={[
          "panel-priority-compact panel-accent-reference relative",
          DashboardPhoenix.PanelStatus.status_classes(:opencode, %{
            server_status: @opencode_server_status,
            sessions: @opencode_sessions
          })
        ]}>
          <.live_component
            module={OpenCodeComponent}
            id="opencode-panel"
            opencode_server_status={@opencode_server_status}
            opencode_sessions={@opencode_sessions}
            opencode_collapsed={@opencode_collapsed}
          />
        </div>

        <!-- Gemini CLI Panel (LiveComponent) - Medium Priority -->
        <div class={[
          "panel-priority-medium relative",
          DashboardPhoenix.PanelStatus.status_classes(:gemini, %{
            server_status: @gemini_server_status,
            output: @gemini_output
          })
        ]}>
          <.live_component
            module={GeminiComponent}
            id="gemini-panel"
            gemini_server_status={@gemini_server_status}
            gemini_output={@gemini_output}
            gemini_collapsed={@gemini_collapsed}
          />
        </div>
      </div>
    </section>

    <!-- ═══════════════════════════════════════════════════════════════════════════ -->
    <!-- SYSTEM CONFIG - Config / Processes                                          -->
    <!-- ═══════════════════════════════════════════════════════════════════════════ -->
    <section class="glass-morphism p-5 section-system-config" style="border-radius: 16px; background: linear-gradient(135deg, rgba(249, 115, 22, 0.10) 0%, rgba(255, 255, 255, 0.05) 100%), rgba(255, 255, 255, 0.05); border-left: 3px solid rgba(249, 115, 22, 0.5);">
      <div class="flex items-center gap-3 mb-4">
        <div class="status-beacon text-orange-400"></div>
        <h2 class="text-section-header text-base-content font-semibold tracking-wide">
          <span class="terminal-cursor">System Config</span>
        </h2>
        <span class="text-xs text-slate-500 dark:text-slate-400 ml-2">Configuration • Processes</span>
      </div>
      <div class="space-y-3">
        <!-- Config Panel (LiveComponent) - Compact Reference -->
        <div class="panel-priority-compact panel-accent-reference">
          <.live_component
            module={ConfigComponent}
            id="config-panel"
            config_collapsed={@config_collapsed}
            coding_agent_pref={@coding_agent_pref}
            agent_mode={@agent_mode}
            last_agent={@last_agent}
            claude_model={@claude_model}
            opencode_model={@opencode_model}
            opencode_server_status={@opencode_server_status}
            gemini_server_status={@gemini_server_status}
          />
        </div>

        <!-- System Processes Panel (LiveComponent) - Medium Priority -->
        <div class="panel-priority-medium">
          <.live_component
            module={SystemProcessesComponent}
            id="system-processes-panel"
            coding_agents={@coding_agents}
            coding_agents_count={@coding_agents_count}
            coding_agents_collapsed={@coding_agents_collapsed}
            recent_processes={@recent_processes}
            recent_processes_count={@recent_processes_count}
            system_processes_collapsed={@system_processes_collapsed}
            process_relationships_collapsed={@process_relationships_collapsed}
            graph_data={@graph_data}
          />
        </div>
      </div>
    </section>

    <!-- Usage Stats - Compact utility bar at bottom -->
    <div class={[
      "glass-morphism panel-priority-compact panel-accent-reference relative",
      DashboardPhoenix.PanelStatus.status_classes(:usage_stats, %{
        opencode: @usage_stats[:opencode] || %{},
        claude: @usage_stats[:claude] || %{}
      })
    ]}>
      <.live_component
        module={UsageStatsComponent}
        id="usage-stats"
        usage_stats={@usage_stats}
      />
    </div>
  </div>

  <!-- Work on Ticket Modal (LiveComponent) -->
  <.live_component
    module={WorkModalComponent}
    id="work-modal"
    show_work_modal={@show_work_modal}
    work_ticket_id={@work_ticket_id}
    work_ticket_details={@work_ticket_details}
    work_ticket_loading={@work_ticket_loading}
    work_in_progress={@work_in_progress}
    work_sent={@work_sent}
    work_error={@work_error}
    coding_agent_pref={@coding_agent_pref}
    agent_mode={@agent_mode}
    last_agent={@last_agent}
    claude_model={@claude_model}
    opencode_model={@opencode_model}
    tickets_in_progress={@tickets_in_progress}
  />
</div>
